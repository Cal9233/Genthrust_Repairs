<!DOCTYPE html>
<html>
<head>
    <title>Get SharePoint Site ID</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            margin-top: 0;
        }
        .step {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .result {
            background: #e8f5e9;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
            display: none;
        }
        .error {
            background: #ffebee;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #f44336;
            display: none;
        }
        code {
            background: #263238;
            color: #aed581;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            display: inline-block;
            word-break: break-all;
        }
        .copy-btn {
            background: #4caf50;
            padding: 8px 16px;
            font-size: 14px;
            margin-left: 10px;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Get SharePoint Site ID</h1>

        <div class="step">
            <h3>Your SharePoint Site:</h3>
            <code>https://genthrustxvii.sharepoint.com/sites/PartsQuotationsWebsite</code>
        </div>

        <div class="step">
            <h3>Step 1: Click the button to sign in and get your Site ID</h3>
            <button id="getSiteId" onclick="getSiteId()">Get Site ID</button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Fetching Site ID...</p>
        </div>

        <div class="result" id="result">
            <h3>‚úÖ Success! Your Site ID is:</h3>
            <div style="margin: 15px 0;">
                <code id="siteIdValue"></code>
                <button class="copy-btn" onclick="copyToClipboard()">Copy</button>
            </div>
            <p><strong>Next Step:</strong> I'll use this to update your configuration automatically!</p>
        </div>

        <div class="error" id="error">
            <h3>‚ùå Error</h3>
            <p id="errorMessage"></p>
        </div>

        <div class="step">
            <h3>What this does:</h3>
            <ul>
                <li>Signs you in with Microsoft</li>
                <li>Queries Microsoft Graph API for your site details</li>
                <li>Extracts the Site ID needed for configuration</li>
                <li>100% secure - uses your existing Azure AD app</li>
            </ul>
        </div>
    </div>

    <script>
        const msalConfig = {
            auth: {
                clientId: 'ee8cb926-5dda-4bbf-9360-dd94d7c433e1',
                authority: 'https://login.microsoftonline.com/ddb0202c-cb5f-425e-891a-5666e58d9ad5',
                redirectUri: window.location.href
            }
        };

        async function getSiteId() {
            document.getElementById('getSiteId').disabled = true;
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            document.getElementById('error').style.display = 'none';

            try {
                // Simple OAuth popup flow
                const authUrl = `https://login.microsoftonline.com/ddb0202c-cb5f-425e-891a-5666e58d9ad5/oauth2/v2.0/authorize?` +
                    `client_id=ee8cb926-5dda-4bbf-9360-dd94d7c433e1` +
                    `&response_type=token` +
                    `&redirect_uri=${encodeURIComponent(window.location.href)}` +
                    `&scope=${encodeURIComponent('https://graph.microsoft.com/Sites.Read.All')}` +
                    `&response_mode=fragment`;

                // Check if we have a token in the URL
                const hash = window.location.hash.substr(1);
                const result = hash.split('&').reduce((res, item) => {
                    const parts = item.split('=');
                    res[parts[0]] = parts[1];
                    return res;
                }, {});

                if (result.access_token) {
                    // We have a token, fetch the site ID
                    const token = result.access_token;

                    const response = await fetch(
                        'https://graph.microsoft.com/v1.0/sites/genthrustxvii.sharepoint.com:/sites/PartsQuotationsWebsite',
                        {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        }
                    );

                    if (!response.ok) {
                        throw new Error(`Graph API error: ${response.status}`);
                    }

                    const data = await response.json();
                    const siteId = data.id;

                    document.getElementById('siteIdValue').textContent = siteId;
                    document.getElementById('result').style.display = 'block';
                    document.getElementById('loading').style.display = 'none';

                    // Clear the hash
                    window.location.hash = '';
                } else {
                    // No token yet, redirect to auth
                    window.location.href = authUrl;
                }
            } catch (error) {
                document.getElementById('errorMessage').textContent = error.message;
                document.getElementById('error').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
                document.getElementById('getSiteId').disabled = false;
            }
        }

        function copyToClipboard() {
            const siteId = document.getElementById('siteIdValue').textContent;
            navigator.clipboard.writeText(siteId);

            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úì Copied!';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        }
    </script>
</body>
</html>
