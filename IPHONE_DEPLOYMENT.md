# iPhone App Deployment Guide
## GenThrust Repairs Mobile App

This guide explains how to build and deploy the GenThrust Repairs app to iPhone using Capacitor and TestFlight.

## Overview

The GenThrust Repairs web app has been converted to a native iOS app using **Capacitor**. This allows the app to:
- Run natively on iPhone
- Access device features (camera, microphone, etc.)
- Work offline (with proper configuration)
- Be distributed via TestFlight for internal testing
- Eventually be published to the App Store

## Prerequisites

### Required Software (macOS Only)

⚠️ **Important**: iOS apps can only be built on macOS with Xcode installed.

1. **macOS** (Monterey 12.0 or later recommended)
2. **Xcode** (14.0 or later)
   - Download from Mac App Store
   - Install Command Line Tools: `xcode-select --install`
3. **CocoaPods** (dependency manager for iOS)
   ```bash
   sudo gem install cocoapods
   ```
4. **Node.js** (v18 or later)
5. **npm** or **yarn**

### Apple Developer Account

You'll need an **Apple Developer Account** to:
- Sign the app
- Deploy to TestFlight
- Publish to App Store (eventually)

**Options:**
- **Individual Account**: $99/year - For personal/single developer
- **Organization Account**: $99/year - For companies (recommended for GenThrust)

Sign up at: https://developer.apple.com/programs/

## Project Structure

```
repair-dashboard/
├── dist/                    # Built web app (generated)
├── ios/                     # Native iOS project (generated by Capacitor)
│   └── App/
│       ├── App.xcodeproj   # Xcode project
│       └── App/
│           ├── App/
│           │   ├── Info.plist
│           │   └── Assets.xcassets/  # App icons
│           └── public/      # Web assets (copied from dist/)
├── capacitor.config.ts      # Capacitor configuration
└── package.json
```

## Step-by-Step Build Process

### Step 1: Transfer Project to Mac

Since the project is currently on Windows, you need to transfer it to a Mac:

**Option A: Using Git (Recommended)**
```bash
# On Windows: Commit and push to GitHub
git add .
git commit -m "Prepare iOS build"
git push

# On Mac: Clone the repository
git clone <your-repo-url>
cd Genthrust_Repairs/repair-dashboard
```

**Option B: Using USB/Network Transfer**
- Copy the entire `Genthrust_Repairs` folder to your Mac
- Use AirDrop, USB drive, or network share

### Step 2: Install Dependencies on Mac

```bash
cd repair-dashboard

# Install Node dependencies
npm install

# Install iOS dependencies (CocoaPods)
cd ios/App
pod install
cd ../..
```

### Step 3: Build the Web App

```bash
# Build the React app for production
npm run build

# This creates the dist/ folder with optimized files
```

### Step 4: Sync with iOS

```bash
# Copy web assets to iOS project and update dependencies
npx cap sync ios
```

This command:
1. Copies `dist/` contents to `ios/App/App/public/`
2. Updates iOS plugins
3. Runs `pod install`

### Step 5: Open in Xcode

```bash
# Open the iOS project in Xcode
npx cap open ios
```

This opens `ios/App/App.xcodeproj` in Xcode.

### Step 6: Configure in Xcode

#### A. Set Bundle Identifier
1. Click on **App** in the project navigator (left sidebar)
2. Select **App** target
3. Go to **General** tab
4. Under **Identity**, verify:
   - **Bundle Identifier**: `com.genthrust.repairs`
   - **Version**: `1.0.0`
   - **Build**: `1`

#### B. Set Team & Signing

1. Still in **General** tab, find **Signing & Capabilities**
2. Check **Automatically manage signing**
3. Select your **Team** (your Apple Developer account)
4. Xcode will automatically create provisioning profiles

#### C. Set Deployment Target

1. In **General** tab
2. Under **Deployment Info**:
   - **Minimum Deployments**: iOS 13.0 (or later)
   - **iPhone** orientation: Portrait, Landscape (as needed)

#### D. Configure App Icons

1. In **Assets.xcassets**, click **AppIcon**
2. Drag and drop your app icon images:
   - 1024x1024 (App Store)
   - 180x180 (iPhone 3x)
   - 120x120 (iPhone 2x)
   - etc.

**Quick way to generate all sizes:**
- Use online tools like https://appicon.co/
- Upload a single 1024x1024 PNG
- Download and drag all generated icons into Xcode

### Step 7: Test on Simulator

1. In Xcode, select a simulator from the device dropdown (e.g., "iPhone 15 Pro")
2. Click **Play** button (▶️) or press **Cmd+R**
3. App should build and launch in the iOS Simulator
4. Test all features:
   - Login/authentication
   - Repair order list
   - AI Assistant
   - Voice input
   - Inventory search

### Step 8: Test on Physical Device

1. Connect your iPhone to Mac via USB
2. Unlock iPhone and trust the computer
3. In Xcode, select your iPhone from device dropdown
4. Click **Play** (▶️)
5. First time: Go to iPhone **Settings** → **General** → **VPN & Device Management**
   - Trust your developer certificate
6. App should launch on your iPhone

### Step 9: Prepare for TestFlight

#### A. Archive the App

1. In Xcode, select **Any iOS Device (arm64)** from device dropdown
2. Go to **Product** → **Archive**
3. Wait for build to complete (may take several minutes)
4. Organizer window opens showing your archive

#### B. Distribute to TestFlight

1. In Organizer, click **Distribute App**
2. Select **App Store Connect**
3. Click **Upload**
4. Select your distribution certificate and provisioning profile
5. Click **Upload**
6. Wait for processing (10-30 minutes)

#### C. Configure in App Store Connect

1. Go to https://appstoreconnect.apple.com/
2. Click **My Apps**
3. If first time:
   - Click **+** → **New App**
   - Fill in details:
     - **Platform**: iOS
     - **Name**: GenThrust Repairs
     - **Primary Language**: English
     - **Bundle ID**: com.genthrust.repairs
     - **SKU**: com.genthrust.repairs
4. Go to **TestFlight** tab
5. Your build should appear under **Builds** (after processing)

#### D. Add Internal Testers

1. In **TestFlight** tab, click **Internal Testing**
2. Click **+** next to **Testers**
3. Add team members by email (up to 100 testers)
4. Testers receive email invitation
5. They install **TestFlight** app from App Store
6. Accept invitation and install GenThrust Repairs

## Development Workflow

### Live Reload During Development

For faster development, you can enable live reload:

1. **Run dev server on Mac:**
   ```bash
   npm run dev
   ```
   Note the URL (e.g., `http://localhost:5173`)

2. **Update `capacitor.config.ts`:**
   ```typescript
   server: {
     url: 'http://YOUR_MAC_IP:5173', // Use your Mac's IP address
     cleartext: true
   }
   ```

3. **Sync and run:**
   ```bash
   npx cap sync ios
   npx cap open ios
   ```

4. **Run in Xcode**
   - App now loads from dev server
   - Changes reflect immediately (no rebuild needed)

### Make Changes

1. Edit code on Mac or Windows
2. If on Windows, push to Git
3. On Mac, pull changes:
   ```bash
   git pull
   npm run build
   npx cap sync ios
   ```
4. In Xcode, click **Play** to test

### Update App Version

Before each TestFlight release:

1. **Update package.json:**
   ```json
   {
     "version": "1.0.1"  // Increment version
   }
   ```

2. **Update in Xcode:**
   - **Version**: `1.0.1` (user-facing)
   - **Build**: `2` (increment for each upload)

3. **Archive and upload** (Step 9)

## Common Build Scripts

Add these to `package.json`:

```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "preview": "vite preview",

    // Capacitor scripts
    "cap:sync": "cap sync",
    "cap:sync:ios": "cap sync ios",
    "cap:open:ios": "cap open ios",
    "cap:build:ios": "npm run build && cap sync ios && cap open ios",

    // Complete iOS build workflow
    "ios": "npm run build && npx cap sync ios && npx cap open ios"
  }
}
```

Usage:
```bash
npm run ios  # Build web app, sync, and open Xcode
```

## Troubleshooting

### Build Errors

**Error**: `Command PhaseScriptExecution failed`
- **Fix**: Clean build folder: **Product** → **Clean Build Folder** (Shift+Cmd+K)

**Error**: `No signing certificate`
- **Fix**: Go to **Signing & Capabilities**, ensure team is selected

**Error**: `CocoaPods not installed`
- **Fix**: `sudo gem install cocoapods`

**Error**: `The app ID cannot be registered`
- **Fix**: Bundle ID might be taken. Change in Xcode and `capacitor.config.ts`

### Sync Issues

**Issue**: Changes not reflecting in app
```bash
# Force clean and rebuild
npm run build
rm -rf ios/App/App/public
npx cap sync ios
```

**Issue**: Pod install fails
```bash
cd ios/App
pod repo update
pod install
cd ../..
```

### TestFlight Issues

**Issue**: Build not appearing in App Store Connect
- Wait 10-30 minutes for processing
- Check email for errors
- Ensure version/build number incremented

**Issue**: Testers not receiving invitation
- Check spam folder
- Ensure email is correct in App Store Connect
- Resend invitation

## Production Deployment

### Before First App Store Release:

1. **Prepare Marketing Materials:**
   - App screenshots (required sizes)
   - App description
   - Keywords
   - Privacy policy URL

2. **Configure App Store Listing:**
   - Go to App Store Connect
   - Fill in all required fields
   - Upload screenshots
   - Set pricing (Free or Paid)

3. **Submit for Review:**
   - Complete all TestFlight testing
   - Submit app for App Store review
   - Review takes 1-3 days typically

4. **Release:**
   - Once approved, set release date
   - App goes live on App Store

## Team Distribution (Internal Only)

If you only need internal distribution (not public App Store):

1. Use **TestFlight** for up to 100 internal testers
2. Or use **Ad Hoc** distribution:
   - Register device UDIDs in developer portal
   - Create Ad Hoc provisioning profile
   - Distribute .ipa file directly

## Backend Configuration

### Important: Update API URLs

For production, update backend URLs in your environment:

**`.env.local` or production environment:**
```bash
# Replace localhost with your deployed backend URL
VITE_API_BASE_URL=https://your-backend-domain.com/api
```

Rebuild after changing:
```bash
npm run build
npx cap sync ios
```

## Security Considerations

1. **HTTPS Required:** iOS requires HTTPS for API calls (except localhost during development)
2. **API Keys:** Never commit API keys to Git
3. **Azure AD:** Ensure redirect URIs include your app's custom scheme
4. **Permissions:** Request permissions in Info.plist:
   ```xml
   <key>NSMicrophoneUsageDescription</key>
   <string>We need microphone access for voice commands</string>
   ```

## Summary Checklist

- [ ] Transfer project to Mac
- [ ] Install Xcode, CocoaPods, Node.js
- [ ] Run `npm install && pod install`
- [ ] Build web app: `npm run build`
- [ ] Sync: `npx cap sync ios`
- [ ] Open Xcode: `npx cap open ios`
- [ ] Configure signing with Apple Developer account
- [ ] Add app icons (1024x1024, etc.)
- [ ] Test on Simulator
- [ ] Test on physical iPhone
- [ ] Archive for TestFlight
- [ ] Upload to App Store Connect
- [ ] Add internal testers
- [ ] Distribute via TestFlight

## Support Resources

- **Capacitor Docs**: https://capacitorjs.com/docs
- **iOS Guide**: https://capacitorjs.com/docs/ios
- **Apple Developer**: https://developer.apple.com/
- **TestFlight**: https://developer.apple.com/testflight/

## Next Steps

1. Transfer project to Mac (if needed)
2. Set up Apple Developer account ($99/year)
3. Follow Step-by-Step guide above
4. Test internally with team via TestFlight
5. Iterate based on feedback
6. (Optional) Submit to App Store for public release

---

**Current Status:** ✅ iOS project created and configured
**Next:** Transfer to Mac and build in Xcode
